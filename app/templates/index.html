<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iceberg Metadata Viewer</title>
    
    <!-- Bootstrap 5 CSS (local) -->
    <link href="/static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons (local) -->
    <link rel="stylesheet" href="/static/vendor/bootstrap-icons/font/bootstrap-icons.css">
    <!-- Highlight.js for code syntax highlighting (local) -->
    <link rel="stylesheet" href="/static/vendor/highlightjs/styles/github.min.css">
    
    <!-- NEW: app custom styles -->
    <link rel="stylesheet" href="/static/css/app.css">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="bi bi-database"></i> Iceberg Metadata Viewer
            </span>
            <span class="navbar-text text-white">
                快速查看 Iceberg 表元数据
            </span>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- 左侧边栏：目录选择 -->
            <div class="col-md-3 sidebar">
                <h5 class="mb-3">
                    <i class="bi bi-folder"></i> Iceberg 表目录
                </h5>
                
                <!-- 路径输入 -->
                <div class="mb-3">
                    <label for="metadataPath" class="form-label">表根目录 (Table Root)</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="metadataPath" 
                               placeholder="/path/to/warehouse/db/table" 
                               value="{{ default_table_root or '' }}">
                        <button class="btn btn-primary" type="button" id="loadBtn">
                            <i class="bi bi-folder2-open"></i> 加载
                        </button>
                    </div>
                </div>

                <!-- 加载状态 -->
                <div id="loadingIndicator" class="d-none">
                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                        <span class="visually-hidden">加载中...</span>
                    </div>
                    <span class="ms-2">扫描目录中...</span>
                </div>

                <!-- 错误提示 -->
                <div id="errorAlert" class="alert alert-danger d-none" role="alert"></div>

                <!-- 文件列表 -->
                <div id="fileList" class="d-none">
                    <h6 class="mt-3 mb-2">
                        <i class="bi bi-file-earmark-text"></i> Metadata 文件
                        <span id="latestVersionBadge" class="badge bg-success ms-2 d-none">最新</span>
                    </h6>
                    <div id="metadataFiles"></div>

                    <h6 class="mt-3 mb-2"><i class="bi bi-table"></i> Partition Stats 文件</h6>
                    <div id="dataParquet"></div>
                </div>
            </div>

            <!-- 右侧主内容区 -->
            <div class="col-md-9">
                <div class="p-3">
                    <!-- 表元数据概览卡片 -->
                    <div id="metadataOverview" class="d-none">
                        <h5 class="mb-3">
                            <i class="bi bi-info-circle"></i> 表元数据概览
                        </h5>

                        <!-- NEW: two-column overview layout -->
                        <div class="row g-2" id="overviewLayout">
                            <!-- Left: metrics -->
                            <div class="col-lg-4">
                                <div id="overviewMetrics"></div>
                            </div>

                            <!-- Right: schema fields table -->
                            <div class="col-lg-8">
                                <div class="card metadata-card" id="schemaFieldsCard">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h6 class="card-title mb-0">
                                                <i class="bi bi-columns"></i> Schema Fields
                                            </h6>
                                            <span class="badge bg-secondary" id="schemaFieldsCount">0</span>
                                        </div>

                                        <div class="table-responsive" id="schemaFieldsTableContainer">
                                            <table class="table table-sm table-striped table-bordered" id="schemaFieldsTable">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 72px;">id</th>
                                                        <th>name</th>
                                                        <th style="width: 96px;">required</th>
                                                        <th>type</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="schemaFieldsTableBody"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <!-- NEW: manifest view container (hidden by default) -->
                                <div id="manifestDataFiles" class="d-none"></div>
                            </div>
                        </div>

                        <!-- keep old container (optional, now unused by JS) -->
                        <div class="row d-none" id="overviewCards"></div>
                    </div>

                    <!-- 内容展示区 -->
                    <div id="contentArea" class="d-none">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 id="contentTitle">
                                <i class="bi bi-file-text"></i> 文件内容
                            </h5>
                            <div>
                                <button class="btn btn-sm btn-outline-secondary" id="copyBtn">
                                    <i class="bi bi-clipboard"></i> 复制
                                </button>
                            </div>
                        </div>

                        <!-- 搜索框 -->
                        <div class="search-box">
                            <input type="text" class="form-control" id="searchInput" 
                                   placeholder="搜索内容...">
                        </div>

                        <div id="tableContainer" class="table-responsive d-none">
                            <table class="table table-sm table-striped table-bordered">
                                <thead id="previewTableHead"></thead>
                                <tbody id="previewTableBody"></tbody>
                            </table>
                        </div>
                        <!-- 代码展示区 -->
                        <div class="code-container">
                            <pre id="codeContent"><code class="language-json"></code></pre>
                        </div>
                    </div>

                    <!-- 空状态 -->
                    <div id="emptyState" class="text-center text-muted mt-5">
                        <i class="bi bi-folder-x" style="font-size: 4rem;"></i>
                        <p class="mt-3">请选择 metadata 目录开始浏览</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS (local) -->
    <script src="/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- Highlight.js (local) -->
    <script src="/static/vendor/highlightjs/highlight.min.js"></script>
    <script src="/static/vendor/highlightjs/languages/json.min.js"></script>

    <!-- NEW: app logic -->
    <script src="/static/js/app.js"></script>
</body>
</html>
